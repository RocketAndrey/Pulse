@page
@model Pulse.Pages.Contracts.IndexModel
@addTagHelper  *, Pulse
@{
    ViewData["Title"] = "index";
}
<meta http-equiv="refresh" content="300;URL=./Execution/index">
<script>

  
    function OnBlurFilter(event) {

        var form = document.forms.filter;
        form.submit(); 
      ;
    }
</script>
<form method="post" id="filter">
    <input type="hidden" asp-for="CurrentMode" />
    <input type="hidden" asp-for="CurrentSort" />


    <div class="btn-group" role="group" aria-label="Basic example">
        <a asp-page="Index" class="btn @(Model.CurrentMode=="all"? "btn-secondary ": "btn-outline-secondary ") btn-sm" asp-route-mode="all">Все</a>
        <a asp-page="Index" class="btn @(Model.CurrentMode!="all"? "btn-secondary ": "btn-outline-secondary ")  btn-sm" asp-route-mode="work">В работе</a>
        <button class="btn btn-outline-secondary btn-sm " ata-toggle="popover" title="Popover title" data-content="And here's some amazing content. It's very engaging. Right?">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" />
            </svg>

        </button>
    </div>
   <p></p>
    <table class="table table-bordered">
        <thead>
            <tr class="table-secondary">
                <th>

                    <a asp-page="./Index" asp-route-sortOrder="@Model.NumberSort"
                       asp-route-currentFilter="@Model.CurrentFilter">
                        @Html.DisplayNameFor(model => model.ContractsVW[0].Number)
                    </a>
                </th>

                <th>
                    <a asp-page="./Index" asp-route-sortOrder="@Model.StartDateSort"
                       asp-route-currentFilter="@Model.CurrentFilter">
                        @Html.DisplayNameFor(model => model.ContractsVW[0].CreationDate)
                    </a>

                </th>
                <th>
                    <a asp-page="./Index" asp-route-sortOrder="@Model.EndDateSort"
                       asp-route-currentFilter="@Model.CurrentFilter">
                        @Html.DisplayNameFor(model => model.ContractsVW[0].EndDate)
                    </a>
                </th>
                <th>
                    <a asp-page="./Index" asp-route-sortOrder="@Model.ClientSort"
                       asp-route-currentFilter="@Model.CurrentFilter">
                        @Html.DisplayNameFor(model => model.ContractsVW[0].Client)
                    </a>
                </th>
                <th>
                    <a asp-page="./Index" asp-route-sortOrder="@Model.CodeSort"
                       asp-route-currentFilter="@Model.CurrentFilter">
                        @Html.DisplayNameFor(model => model.ContractsVW[0].Code)
                    </a>

                </th>
                <th>
                    @Html.DisplayNameFor(model => model.ContractsVW[0].CompleteString)
                </th>
            </tr>
        </thead>
        <tbody>
            <tr class="table-secondary">
                <td>
                    <input asp-for="contractsFilter.Number" onblur="OnBlurFilter(this)" class="form-control form-control-sm" placeholder="номер" />
                </td>
                <td>
                    <input disabled asp-for="contractsFilter.StartDate" onblur="OnBlurFilter(this)" class="form-control form-control-sm " />
                </td>
                <td>
                    <input disabled asp-for="contractsFilter.EndDate" onblur="OnBlurFilter(this)" class="form-control form-control-sm" />
                </td>
                <td>
                    <select asp-for="contractsFilter.OrganizationID" onblur="OnBlurFilter(this)" class="form-control form-control-sm" asp-items="ViewBag.OrganizationID" placeholder="Заказчик"></select>
                </td>
                <td>
                    <input asp-for="contractsFilter.Code" onblur="OnBlurFilter(this)" class="form-control form-control-sm" placeholder="код договора" />
                </td>
                <td></td>
            </tr>
            @foreach (var item in Model.ContractsVW)
            {
                string selectedRow = item.Complete ? "table-success" : item.MissedEndDate ? "table-danger" : "";

                <tr class=@selectedRow>
                    <td>

                        <a asp-page="Wares" asp-route-contractID="@item.ContractId">
                            @Html.DisplayFor(modelItem => item.Number)
                        </a>
                    </td>
                    <td>
                        @item?.CreationDate?.ToString("d")
                    </td>
                    <td>
                        @item?.EndDate?.ToString("d")
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Client)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Code)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CompleteString)
                    </td>
                </tr>
            }
        </tbody>
    </table>
</form>
<page-link page-model="Model.ContractsVW"
           page-url-pageIndex="@(Model.ContractsVW.PageIndex - 1)"
           page-url-currentFilter="@(Model.CurrentFilter)"
           page-url-sortorder="@(Model.CurrentSort)"></page-link>
